<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â€” Ù†Ø¸Ø§Ù… ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:"Cairo",sans-serif;background:linear-gradient(180deg,#071025,#02102a);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .box{width:100%;max-width:420px;padding:26px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    h2{margin:0 0 10px;font-size:24px}
    .subtitle{color:#9fb7cc;font-size:14px;margin-bottom:20px}
    label{display:block;color:#b8c6db;margin-top:12px;font-size:14px;font-weight:500}
    input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:6px;font-size:15px;transition:border-color 0.3s}
    input:focus{outline:none;border-color:rgba(79,209,197,0.4)}
    .btn{background:linear-gradient(90deg,#4fd1c5,#5a67d8);border:none;padding:12px 14px;border-radius:10px;color:#022036;font-weight:800;cursor:pointer;margin-top:12px;width:100%;font-size:15px;transition:transform 0.2s}
    .btn:hover{transform:translateY(-2px)}
    .btn:active{transform:translateY(0)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .btn-secondary{background:transparent;color:#b8c6db;border:1px solid rgba(255,255,255,0.08);margin-top:8px}
    .hint{color:#9fb7cc;font-size:13px;margin-top:14px;line-height:1.5}
    .creds{background:rgba(79,209,197,0.05);padding:12px;border-radius:8px;margin-top:16px;font-size:13px;color:#cfeff1;border:1px solid rgba(79,209,197,0.1)}
    .status{margin-top:12px;padding:10px;border-radius:8px;font-size:13px;text-align:center}
    .status.success{background:rgba(79,209,197,0.1);color:#4fd1c5;border:1px solid rgba(79,209,197,0.2)}
    .status.error{background:rgba(255,107,107,0.1);color:#ff6b6b;border:1px solid rgba(255,107,107,0.2)}
    .status.info{background:rgba(90,103,216,0.1);color:#5a67d8;border:1px solid rgba(90,103,216,0.2)}
  </style>
</head>
<body>
  <div class="box" role="main" aria-labelledby="title">
    <h2 id="title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <div class="subtitle">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ ÙƒÙ€ Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</div>

    <div id="statusDiv"></div>

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
    <input id="username" placeholder="Ù…Ø«Ø§Ù„: mandoub Ø£Ùˆ admin" autocomplete="username" />

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="password" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />

    <button class="btn" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <button class="btn btn-secondary" id="guestBtn">ØªØ¬Ø±Ø¨Ø© ÙƒØ²Ø§Ø¦Ø±</button>

    <div class="hint">
      ğŸ”’ ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­<br>
      â˜ï¸ Ø­Ø§Ù„Ø© Firebase: <strong id="firebaseStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</strong>
    </div>

    <div class="creds">
      <strong>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</strong><br>
      â€¢ Ù…Ù†Ø¯ÙˆØ¨: <strong>mandoub</strong> / <strong>1234</strong><br>
      â€¢ Ù…Ø§Ù„Ùƒ: <strong>admin</strong> / <strong>9999</strong>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAZdj86H_cYRTP2xQfF0_YqnCZDPnRnWis",
    authDomain: "mandouby-79556.firebaseapp.com",
    databaseURL: "https://mandouby-79556-default-rtdb.firebaseio.com",
    projectId: "mandouby-79556",
    storageBucket: "mandouby-79556.firebasestorage.app",
    messagingSenderId: "842326054163",
    appId: "1:842326054163:web:32d2611067e45c30ef76e6",
    measurementId: "G-EJ14KM885Y"
  };

  let useFirestore = false;
  let db = null;
  let analytics = null;

  try {
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    analytics = firebase.analytics();
    useFirestore = true;
    document.getElementById('firebaseStatus').textContent = 'âœ… Ù…ØªØµÙ„';
    document.getElementById('firebaseStatus').style.color = '#4fd1c5';
    console.log('Firebase initialized successfully');
  } catch(e){ 
    console.warn('Firebase initialization error:', e);
    document.getElementById('firebaseStatus').textContent = 'âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„ (ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ)';
    document.getElementById('firebaseStatus').style.color = '#ff6b6b';
  }

  // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
  const USERS = {
    mandoub: { role: 'mandoub', pass: '1234', displayName: 'Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' },
    admin:   { role: 'admin', pass: '9999', displayName: 'Ø§Ù„Ù…Ø§Ù„Ùƒ' }
  };

  const SESSION_KEY = 'app_session_v1';
  const statusDiv = document.getElementById('statusDiv');
  const loginBtn = document.getElementById('loginBtn');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');

  function showStatus(message, type = 'info') {
    statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    setTimeout(() => {
      if(type !== 'error') statusDiv.innerHTML = '';
    }, 3000);
  }

  async function logLoginToFirestore(username, role) {
    if(!useFirestore) return;
    try {
      await db.collection('login_logs').add({
        username: username,
        role: role,
        timestamp: new Date(),
        userAgent: navigator.userAgent,
        ip: 'client-side' // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Cloud Function Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ IP
      });
      console.log('Login logged to Firestore');
    } catch(e) {
      console.warn('Failed to log login:', e);
    }
  }

  async function handleLogin() {
    const u = usernameInput.value.trim();
    const p = passwordInput.value.trim();
    
    if(!u || !p){ 
      showStatus('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
      return; 
    }

    loginBtn.disabled = true;
    loginBtn.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';

    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ­Ù‚Ù‚
    await new Promise(resolve => setTimeout(resolve, 500));

    if(USERS[u] && USERS[u].pass === p){
      // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙÙŠ localStorage
      const session = { 
        username: u, 
        displayName: USERS[u].displayName,
        role: USERS[u].role, 
        loggedAt: new Date().toISOString() 
      };
      localStorage.setItem(SESSION_KEY, JSON.stringify(session));

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Firebase
      await logLoginToFirestore(u, USERS[u].role);

      // ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Analytics
      if(analytics) {
        analytics.logEvent('login', {
          method: 'username_password',
          role: USERS[u].role
        });
      }

      showStatus('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');

      // ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      setTimeout(() => {
        if(USERS[u].role === 'mandoub') window.location.href = 'mandoub.html';
        else if(USERS[u].role === 'admin') window.location.href = 'admin.html';
        else window.location.href = 'mandoub.html';
      }, 800);
    } else {
      showStatus('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
      loginBtn.disabled = false;
      loginBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
      
      // Ù‡Ø² Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ø®Ø·Ø£
      document.querySelector('.box').style.animation = 'shake 0.5s';
      setTimeout(() => {
        document.querySelector('.box').style.animation = '';
      }, 500);
    }
  }

  loginBtn.addEventListener('click', handleLogin);

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
  passwordInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') handleLogin();
  });
  usernameInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') handleLogin();
  });

  // ØªØ¬Ø±Ø¨Ø© ÙƒØ²Ø§Ø¦Ø±
  document.getElementById('guestBtn').addEventListener('click', async ()=>{
    const session = { 
      username: 'guest', 
      displayName: 'Ø²Ø§Ø¦Ø±',
      role: 'mandoub', 
      loggedAt: new Date().toISOString() 
    };
    localStorage.setItem(SESSION_KEY, JSON.stringify(session));
    
    await logLoginToFirestore('guest', 'mandoub');
    
    if(analytics) {
      analytics.logEvent('login', {
        method: 'guest',
        role: 'mandoub'
      });
    }
    
    showStatus('âœ… ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±', 'success');
    setTimeout(() => {
      window.location.href = 'mandoub.html';
    }, 500);
  });

  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙ†ÙˆÙ‘Ø¬Ù‡Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  (function autoRedirectIfLogged(){
    try {
      const s = JSON.parse(localStorage.getItem(SESSION_KEY)||'null');
      if(s && s.role) {
        showStatus('ğŸ”„ Ù„Ø¯ÙŠÙƒ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...', 'info');
        setTimeout(() => {
          if(s.role === 'mandoub' || s.role === 'guest') window.location.href = 'mandoub.html';
          else if(s.role === 'admin') window.location.href = 'admin.html';
        }, 1000);
      }
    } catch(e){}
  })();

  // Ø¥Ø¶Ø§ÙØ© animation Ù„Ù„Ù‡Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
      20%, 40%, 60%, 80% { transform: translateX(8px); }
    }
  `;
  document.head.appendChild(style);
</script>
</body>
</html>